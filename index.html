<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SK Poultry Farm</title>
  <style>
    /* ---------- Basic layout & variables ---------- */
    :root{
      --accent:#2563eb;
      --muted:#6b7280;
      --card-bg:#ffffff;
      --page-bg:#f3f6fb;
      --radius:12px;
      --shadow: 0 8px 20px rgba(16,24,40,0.06);
      --container:1100px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0; background:var(--page-bg); color:#0f172a}
    .wrap{max-width:var(--container); margin:28px auto; padding:20px}

    /* header */
    .header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
    .brand{display:flex;align-items:center;gap:14px}
    .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#7c3aed);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:20px}
    h1{font-size:20px;margin:0}
    .clock{color:var(--muted);font-size:14px}

    /* cards and grid */
    .grid{display:grid;grid-template-columns:360px 1fr;gap:16px}
    .card{background:var(--card-bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px}
    .small{font-size:13px;color:var(--muted)}

    /* buttons & inputs */
    .btn{background:var(--accent);color:#fff;border:0;padding:10px 12px;border-radius:10px;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(37,99,235,0.12)}
    input[type="number"], input[type="text"], select{width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9ef}
    label{display:block;margin-bottom:6px;font-size:13px}

    /* summary */
    .stat{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .stat .big{font-size:18px;font-weight:700}
    .muted{color:var(--muted)}

    /* history tables */
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{padding:8px 6px;text-align:left;border-bottom:1px solid #f1f3f6}
    th{color:var(--muted);font-weight:600}

    /* helpers */
    .row{display:flex;gap:8px}
    .col{display:flex;flex-direction:column;gap:8px}
    .hide{display:none}
    .notify{padding:10px;border-radius:8px;background:#fffbeb;color:#92400e;border:1px solid #fde68a}
    .ok{background:#ecfeff;color:#065f46;border:1px solid #bbf7d0}

    /* responsive */
    @media (max-width:900px){
      .grid{grid-template-columns:1fr;}
      .brand h1{font-size:18px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="brand">
        <div class="logo">SK</div>
        <div>
          <h1 id="farmName">SK Poultry Farm</h1>
          <div class="clock" id="clock">Loading...</div>
        </div>
      </div>
      <div style="text-align:right">
        <div class="small">Quick summary</div>
        <div class="stat">
          <div class="small">Day <span id="frontDay">1</span></div>
          <div class="small">Chicks <strong id="frontChicks">15000</strong></div>
          <div class="small">Feed <strong id="frontFeed">750 kg</strong></div>
        </div>
        <div style="margin-top:8px">
          <button class="btn" id="btnDetails">Details</button>
        </div>
      </div>
    </div>

    <!-- MAIN GRID -->
    <div class="grid">

      <!-- Left column: Actions and quick forms -->
      <div>
        <div id="frontCard" class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
            <strong>Front Page</strong>
            <small class="muted">Open details to manage daily tasks</small>
          </div>
          <p class="small">Press <strong>Details</strong> to go to the farm manager page where you can calculate feed, record feed, mortality, weight and sales.</p>
        </div>

        <!-- Details card (hidden in front view) -->
        <div id="detailsCard" class="card hide">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div>
              <div class="small">Current Day</div>
              <div class="big" id="detailDay">Day 1</div>
            </div>
            <div style="text-align:right">
              <div class="small">Chicks</div>
              <div id="detailChicks" class="big">15000</div>
            </div>
          </div>
          <div style="margin-top:10px" class="small">Feed available: <strong id="detailFeed">750 kg</strong> (<span id="detailFeedBags">10</span> bags × <span id="detailBagKg">75</span> kg)</div>

          <div style="margin-top:12px" class="row">
            <button class="btn" id="btnBack">Back</button>
            <button class="btn ghost" id="btnNextDay">Next Day</button>
            <button class="btn ghost" id="btnExport">Export JSON</button>
            <button class="btn ghost" id="btnReset">Reset</button>
          </div>

        </div>

        <!-- Quick actions: calculate feed, record feed etc. -->
        <div id="actionsCard" class="card hide" style="margin-top:12px">
          <strong>Daily Actions</strong>
          <div style="margin-top:8px" class="col">

            <!-- calculate daily feed -->
            <div>
              <label>Grams per bird (today)</label>
              <div class="row">
                <input type="number" id="gramsPerBird" placeholder="e.g. 30" min="0" value="30" />
                <button class="btn" id="btnCalcFeed">Calculate</button>
              </div>
              <div class="small" style="margin-top:6px">Needed today: <strong id="calcFeedResult">—</strong></div>
            </div>

            <hr style="border:none;height:8px">

            <!-- record feed usage -->
            <div>
              <label>Record feed used (bags) — allow fractional (e.g. 0.5)</label>
              <div class="row">
                <input type="number" id="feedBagsUsed" placeholder="bags used" min="0" step="0.01" />
                <button class="btn" id="btnRecordFeed">Record Feed</button>
              </div>
              <div class="small" style="margin-top:6px" id="feedMsg"></div>
            </div>

            <hr style="border:none;height:8px">

            <!-- mortality -->
            <div>
              <label>Record mortality (count)</label>
              <div class="row">
                <input type="number" id="mortalityCount" placeholder="e.g. 10" min="0" />
                <button class="btn" id="btnRecordMort">Record</button>
              </div>
              <div class="small" style="margin-top:6px" id="mortMsg"></div>
            </div>

            <hr style="border:none;height:8px">

            <!-- weight -->
            <div>
              <label>Record average weight (kg)</label>
              <div class="row">
                <input type="number" id="avgWeight" placeholder="e.g. 0.04" min="0" step="0.001" />
                <button class="btn" id="btnRecordWeight">Record</button>
              </div>
              <div class="small" style="margin-top:6px" id="weightMsg"></div>
            </div>

            <hr style="border:none;height:8px">

            <!-- sale -->
            <div>
              <label>Record sale</label>
              <div class="row">
                <input type="text" id="saleDealer" placeholder="Dealer name" />
                <input type="number" id="saleCount" placeholder="count" min="0" />
                <button class="btn" id="btnRecordSale">Sell</button>
              </div>
              <div class="small" style="margin-top:6px" id="saleMsg"></div>
            </div>

          </div>
        </div>

      </div>

      <!-- Right column: History and reminders -->
      <div>
        <div id="reminders" class="card hide">
          <strong>Reminders & Schedule</strong>
          <div style="margin-top:8px" id="scheduleMsg" class="small muted">—</div>
        </div>

        <div id="historyCards" class="card hide" style="margin-top:12px">
          <strong>Histories</strong>

          <div style="margin-top:10px">
            <div class="small">Feed history</div>
            <table id="feedTable">
              <thead><tr><th>Day</th><th>Date/Time</th><th>Bags</th><th>kg</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>

          <div style="margin-top:10px">
            <div class="small">Mortality history</div>
            <table id="mortTable"><thead><tr><th>Day</th><th>Date/Time</th><th>Count</th></tr></thead><tbody></tbody></table>
          </div>

          <div style="margin-top:10px">
            <div class="small">Weight records</div>
            <table id="weightTable"><thead><tr><th>Day</th><th>Date/Time</th><th>Avg kg</th></tr></thead><tbody></tbody></table>
          </div>

          <div style="margin-top:10px">
            <div class="small">Sales history</div>
            <table id="saleTable"><thead><tr><th>Day</th><th>Date/Time</th><th>Dealer</th><th>Count</th></tr></thead><tbody></tbody></table>
          </div>

        </div>
      </div>

    </div>
  </div>

  <script>
    /***********************
     *  SK Poultry Farm logic
     ***********************/

    let data = null;
    const STORAGE_KEY = 'sk_farm_data_v1';

    document.addEventListener('DOMContentLoaded', init);

    function init(){
      loadData();
      // start clock
      updateClock();
      setInterval(updateClock, 1000);

      // wire buttons
      document.getElementById('btnDetails').addEventListener('click', showDetails);
      document.getElementById('btnBack').addEventListener('click', showFront);
      document.getElementById('btnCalcFeed').addEventListener('click', calculateDailyFeed);
      document.getElementById('btnRecordFeed').addEventListener('click', recordFeed);
      document.getElementById('btnRecordMort').addEventListener('click', recordMortality);
      document.getElementById('btnRecordWeight').addEventListener('click', recordWeight);
      document.getElementById('btnRecordSale').addEventListener('click', recordSale);
      document.getElementById('btnNextDay').addEventListener('click', nextDay);
      document.getElementById('btnExport').addEventListener('click', exportJSON);
      document.getElementById('btnReset').addEventListener('click', resetData);

      // render front
      renderFront();
    }

    function defaultData(){
      const chicks = 15000;
      const feedBags = 10;
      const bagKg = 75;
      return {
        farmName: 'SK Poultry Farm',
        currentDay: 1,
        chicks: chicks,
        feedBags: feedBags,
        bagKg: bagKg,
        feedKgAvailable: feedBags * bagKg, // 10 * 75 = 750
        feedHistory: [],
        mortalityHistory: [],
        weightRecords: [],
        saleHistory: [],
        saleCount: 0,
        settings: {
          saleStartDay: 105,
          medicineDays: [5,6,21,60,90],
          noseCutDays: [25,70]
        }
      };
    }

    function loadData(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(raw){
        try{ data = JSON.parse(raw); }
        catch(e){ data = defaultData(); }
      } else {
        data = defaultData();
      }
      saveData();
    }

    function saveData(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      renderFront();
    }

    function resetData(){
      if(!confirm('Reset all data to initial values?')) return;
      data = defaultData();
      saveData();
      alert('Data reset.');
      showFront();
    }

    function updateClock(){
      const now = new Date();
      document.getElementById('clock').textContent = now.toLocaleString();
    }

    /* ---------- Views ---------- */
    function renderFront(){
      document.getElementById('farmName').textContent = data.farmName;
      document.getElementById('frontDay').textContent = data.currentDay;
      document.getElementById('frontChicks').textContent = data.chicks;
      document.getElementById('frontFeed').textContent = formatKg(data.feedKgAvailable) + ' kg';

      // details page elements
      document.getElementById('detailDay').textContent = 'Day ' + data.currentDay;
      document.getElementById('detailChicks').textContent = data.chicks;
      document.getElementById('detailFeed').textContent = formatKg(data.feedKgAvailable) + ' kg';
      document.getElementById('detailFeedBags').textContent = (data.feedKgAvailable / data.bagKg).toFixed(2);
      document.getElementById('detailBagKg').textContent = data.bagKg;

      // hide/show areas
      // frontCard always visible; details elements controlled by show/hide functions
    }

    function showDetails(){
      document.getElementById('detailsCard').classList.remove('hide');
      document.getElementById('actionsCard').classList.remove('hide');
      document.getElementById('reminders').classList.remove('hide');
      document.getElementById('historyCards').classList.remove('hide');
      document.getElementById('frontCard').classList.add('hide');
      document.getElementById('btnDetails').disabled = true;
      renderFront();
      renderHistoryTables();
      renderScheduleMsg();
    }

    function showFront(){
      document.getElementById('detailsCard').classList.add('hide');
      document.getElementById('actionsCard').classList.add('hide');
      document.getElementById('reminders').classList.add('hide');
      document.getElementById('historyCards').classList.add('hide');
      document.getElementById('frontCard').classList.remove('hide');
      document.getElementById('btnDetails').disabled = false;
      renderFront();
    }

    /* ---------- Calculations & Records ---------- */
    function calculateDailyFeed(){
      const grams = parseFloat(document.getElementById('gramsPerBird').value);
      if(isNaN(grams) || grams <= 0){
        document.getElementById('calcFeedResult').textContent = 'Enter a valid grams per bird.';
        return;
      }
      // dailyKg = (chicks * gramsPerBird) / 1000
      // show step-by-step calculation (simple)
      const totalGrams = data.chicks * grams;
      const dailyKg = totalGrams / 1000;
      // display
      document.getElementById('calcFeedResult').textContent = dailyKg.toFixed(3) + ' kg (\n' + data.chicks + ' × ' + grams + ' g = ' + totalGrams + ' g → ' + dailyKg.toFixed(3) + ' kg)';

      if(dailyKg > data.feedKgAvailable){
        document.getElementById('calcFeedResult').textContent += ' — NOT ENOUGH FEED available!';
      }
    }

    function recordFeed(){
      const bagsUsed = parseFloat(document.getElementById('feedBagsUsed').value);
      const t = new Date().toISOString();
      const msgElm = document.getElementById('feedMsg');
      msgElm.textContent = '';
      if(isNaN(bagsUsed) || bagsUsed <= 0){ msgElm.textContent = 'Enter a valid number of bags used.'; return; }

      const kgUsed = bagsUsed * data.bagKg;
      if(kgUsed > data.feedKgAvailable + 0.0001){ msgElm.textContent = 'Not enough feed available. You tried to use ' + kgUsed.toFixed(2) + ' kg but only ' + data.feedKgAvailable.toFixed(2) + ' kg available.'; return; }

      // apply
      data.feedKgAvailable = Number((data.feedKgAvailable - kgUsed).toFixed(4));
      data.feedHistory.unshift({day: data.currentDay, dateTime: t, bagsUsed: bagsUsed, kgUsed: kgUsed});
      saveData();
      msgElm.textContent = 'Recorded ' + kgUsed.toFixed(2) + ' kg (' + bagsUsed + ' bags).';
      document.getElementById('feedBagsUsed').value = '';
      renderHistoryTables();
      renderFront();
    }

    function recordMortality(){
      const cnt = parseInt(document.getElementById('mortalityCount').value, 10);
      const t = new Date().toISOString();
      const msgElm = document.getElementById('mortMsg');
      msgElm.textContent = '';
      if(isNaN(cnt) || cnt < 0){ msgElm.textContent = 'Enter a valid mortality number.'; return; }
      if(cnt > data.chicks){ msgElm.textContent = 'Mortality cannot exceed current chicks (' + data.chicks + ').'; return; }

      data.chicks -= cnt;
      data.mortalityHistory.unshift({day: data.currentDay, dateTime: t, count: cnt});
      saveData();
      msgElm.textContent = 'Recorded mortality: ' + cnt + ' birds.';
      document.getElementById('mortalityCount').value = '';
      renderHistoryTables();
    }

    function recordWeight(){
      const kg = parseFloat(document.getElementById('avgWeight').value);
      const t = new Date().toISOString();
      const msgElm = document.getElementById('weightMsg');
      msgElm.textContent = '';
      if(isNaN(kg) || kg <= 0){ msgElm.textContent = 'Enter a valid average weight in kg.'; return; }
      data.weightRecords.unshift({day: data.currentDay, dateTime: t, avgKg: kg});
      saveData();
      msgElm.textContent = 'Recorded average weight: ' + kg.toFixed(3) + ' kg';
      document.getElementById('avgWeight').value = '';
      renderHistoryTables();
    }

    function recordSale(){
      const dealer = (document.getElementById('saleDealer').value || '').trim();
      const cnt = parseInt(document.getElementById('saleCount').value, 10);
      const t = new Date().toISOString();
      const msgElm = document.getElementById('saleMsg');
      msgElm.textContent = '';
      if(!dealer){ msgElm.textContent = 'Enter dealer name.'; return; }
      if(isNaN(cnt) || cnt <= 0){ msgElm.textContent = 'Enter a valid sale count.'; return; }
      if(cnt > data.chicks){ msgElm.textContent = 'Sale count cannot exceed current chicks (' + data.chicks + ').'; return; }

      data.chicks -= cnt;
      data.saleHistory.unshift({day: data.currentDay, dateTime: t, dealer: dealer, count: cnt});
      data.saleCount = (data.saleCount || 0) + cnt;
      saveData();
      msgElm.textContent = 'Recorded sale: ' + cnt + ' birds to ' + dealer;
      document.getElementById('saleDealer').value = '';
      document.getElementById('saleCount').value = '';
      renderHistoryTables();
      renderFront();
    }

    function nextDay(){
      data.currentDay += 1;
      saveData();
      renderFront();
      renderScheduleMsg(true);
      alert('Advanced to Day ' + data.currentDay);
    }

    /* ---------- History rendering ---------- */
    function renderHistoryTables(){
      // feed
      const feedT = document.querySelector('#feedTable tbody'); feedT.innerHTML = '';
      for(const r of data.feedHistory){
        const tr = document.createElement('tr');
        tr.innerHTML = '<td>' + r.day + '</td><td>' + formatDateTime(r.dateTime) + '</td><td>' + r.bagsUsed + '</td><td>' + r.kgUsed.toFixed(2) + '</td>';
        feedT.appendChild(tr);
      }
      // mort
      const mortT = document.querySelector('#mortTable tbody'); mortT.innerHTML = '';
      for(const r of data.mortalityHistory){
        const tr = document.createElement('tr');
        tr.innerHTML = '<td>' + r.day + '</td><td>' + formatDateTime(r.dateTime) + '</td><td>' + r.count + '</td>';
        mortT.appendChild(tr);
      }
      // weight
      const wT = document.querySelector('#weightTable tbody'); wT.innerHTML = '';
      for(const r of data.weightRecords){
        const tr = document.createElement('tr');
        tr.innerHTML = '<td>' + r.day + '</td><td>' + formatDateTime(r.dateTime) + '</td><td>' + r.avgKg.toFixed(3) + '</td>';
        wT.appendChild(tr);
      }
      // sale
      const sT = document.querySelector('#saleTable tbody'); sT.innerHTML = '';
      for(const r of data.saleHistory){
        const tr = document.createElement('tr');
        tr.innerHTML = '<td>' + r.day + '</td><td>' + formatDateTime(r.dateTime) + '</td><td>' + escapeHtml(r.dealer) + '</td><td>' + r.count + '</td>';
        sT.appendChild(tr);
      }
    }

    /* ---------- Helpers & utilities ---------- */
    function formatKg(x){ return Number(x).toFixed(2); }
    function formatDateTime(iso){ return new Date(iso).toLocaleString(); }
    function escapeHtml(s){ return s.replace(/[&<>"']/g, function(c){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c]; }); }

    function renderScheduleMsg(showAlert){
      const d = data.currentDay;
      const meds = data.settings.medicineDays.includes(d);
      const nose = data.settings.noseCutDays.includes(d);
      const sale = d >= data.settings.saleStartDay;
      let parts = [];
      if(meds) parts.push('Medicine day — give regular medicine.');
      if(nose) parts.push('Nose cutting + medicine scheduled today.');
      if(sale) parts.push('Sales allowed from Day ' + data.settings.saleStartDay + '.');
      if(parts.length===0) parts.push('No scheduled special tasks today.');
      document.getElementById('scheduleMsg').textContent = parts.join(' ');
      if(showAlert && parts.length>0) alert(parts.join('\n'));
    }

    function exportJSON(){
      const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'sk_poultry_data.json';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }

  </script>
</body>
</html>
